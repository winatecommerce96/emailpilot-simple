# Phase 3: Calendar Frontend - Strategy Summary Implementation

## Overview

This document provides comprehensive instructions for implementing Strategy Summary display in the EmailPilot Calendar React application. The Strategy Summary feature provides high-level marketing strategy context generated by Claude Sonnet 4.5, helping users understand the strategic thinking behind their campaign calendar.

**Prerequisites:**
- Phase 1 complete: emailpilot-simple generating and saving strategy_summary JSON files
- Phase 2 complete: emailpilot-app backend with strategy_summary endpoints
- React application setup with TypeScript
- Tailwind CSS configured
- API client configured to communicate with emailpilot-app backend

**Phase 3 Deliverables:**
1. TypeScript interfaces matching backend schema
2. React component for displaying strategy summary
3. API integration for fetching strategy summary
4. UI/UX implementation with Tailwind CSS
5. Component tests with React Testing Library
6. Documentation updates

---

## Implementation Checklist

Use this checklist to track Phase 3 implementation progress:

- [ ] 1. Create TypeScript interfaces for StrategySummary
- [ ] 2. Implement API client method for fetching strategy summary
- [ ] 3. Create StrategyCard React component
- [ ] 4. Integrate StrategyCard into Calendar view
- [ ] 5. Add loading and error states
- [ ] 6. Implement Tailwind CSS styling
- [ ] 7. Write component tests
- [ ] 8. Update Calendar component documentation
- [ ] 9. Test with real workflow data

---

## 1. TypeScript Interfaces

### Location
Create or update: `frontend/src/types/strategy.ts`

### Code

```typescript
/**
 * Strategy Summary TypeScript Interfaces
 *
 * These interfaces match the backend Pydantic models defined in Phase 2.
 * Generated by Claude Sonnet 4.5 during calendar creation.
 */

/**
 * High-level marketing strategy for a calendar period.
 * Generated by Claude Sonnet 4.5 in Stage 2 of calendar workflow.
 */
export interface StrategySummary {
  /** Unique identifier for the strategy summary document */
  id?: string;

  /** Client identifier (e.g., 'rogue-creamery') */
  client_id: string;

  /** Start date of the calendar period (ISO format: YYYY-MM-DD) */
  start_date: string;

  /** End date of the calendar period (ISO format: YYYY-MM-DD) */
  end_date: string;

  /** Top 3-5 strategic insights and recommendations */
  key_insights: string[];

  /** Audience segmentation and targeting strategy */
  targeting_approach: string;

  /** Send time optimization and campaign cadence recommendations */
  timing_strategy: string;

  /** Content themes, messaging approach, and creative direction */
  content_strategy: string;

  /** Timestamp when the strategy was created */
  created_at?: string;

  /** Timestamp when the strategy was last updated */
  updated_at?: string;

  /** Model identifier that generated the strategy (e.g., 'claude-sonnet-4-5-20250929') */
  generated_by?: string;

  /** Number of events in the associated calendar */
  event_count?: number;
}

/**
 * API response wrapper for strategy summary endpoint.
 */
export interface StrategySummaryResponse {
  data: StrategySummary;
  status: 'success' | 'error';
  message?: string;
}

/**
 * Loading state for async strategy summary fetching.
 */
export interface StrategySummaryState {
  data: StrategySummary | null;
  loading: boolean;
  error: string | null;
}
```

### Usage Example

```typescript
import { StrategySummary } from '@/types/strategy';

const summary: StrategySummary = {
  id: 'abc123',
  client_id: 'rogue-creamery',
  start_date: '2026-01-01',
  end_date: '2026-01-31',
  key_insights: [
    'Focus on cheese pairing education to drive premium SKU sales',
    'Leverage seasonal winter themes for January content',
    'Emphasize gift boxes and subscription bundles post-holiday'
  ],
  targeting_approach: 'Segment by purchase history: VIP customers get exclusive previews, occasional buyers receive re-engagement offers, and new subscribers see product education content',
  timing_strategy: 'Tuesday/Thursday sends at 10 AM PST for optimal open rates. Weekly cadence with strategic Friday sends for weekend purchase intent',
  content_strategy: 'Educational content on cheese varieties and pairings, seasonal recipes, behind-the-scenes farm stories, and exclusive member offers',
  created_at: '2025-11-18T19:48:16Z',
  generated_by: 'claude-sonnet-4-5-20250929',
  event_count: 24
};
```

---

## 2. API Client Integration

### Location
Update: `frontend/src/services/api.ts` (or your API client file)

### Code

```typescript
import axios, { AxiosInstance } from 'axios';
import { StrategySummary } from '@/types/strategy';

/**
 * API Client for EmailPilot Backend
 */
class EmailPilotAPI {
  private client: AxiosInstance;

  constructor(baseURL: string = import.meta.env.VITE_API_URL || 'http://localhost:8008') {
    this.client = axios.create({
      baseURL,
      headers: {
        'Content-Type': 'application/json',
      },
    });
  }

  /**
   * Fetch strategy summary for a client and date range.
   *
   * @param clientId - Client identifier (e.g., 'rogue-creamery')
   * @param startDate - Optional start date filter (ISO format: YYYY-MM-DD)
   * @param endDate - Optional end date filter (ISO format: YYYY-MM-DD)
   * @returns Promise<StrategySummary>
   * @throws Error if strategy summary not found (404) or request fails
   */
  async getStrategySummary(
    clientId: string,
    startDate?: string,
    endDate?: string
  ): Promise<StrategySummary> {
    try {
      const params = new URLSearchParams();
      if (startDate) params.append('start_date', startDate);
      if (endDate) params.append('end_date', endDate);

      const queryString = params.toString() ? `?${params.toString()}` : '';
      const url = `/api/calendar/strategy-summary/${clientId}${queryString}`;

      const response = await this.client.get<StrategySummary>(url);
      return response.data;
    } catch (error) {
      if (axios.isAxiosError(error)) {
        if (error.response?.status === 404) {
          throw new Error(`No strategy summary found for ${clientId}`);
        }
        throw new Error(error.response?.data?.detail || 'Failed to fetch strategy summary');
      }
      throw error;
    }
  }

  // ... other API methods ...
}

// Export singleton instance
export const api = new EmailPilotAPI();
```

### Alternative: React Query Integration

If using React Query (TanStack Query):

```typescript
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';
import { StrategySummary } from '@/types/strategy';

/**
 * React Query hook for fetching strategy summary.
 *
 * @param clientId - Client identifier
 * @param startDate - Optional start date filter
 * @param endDate - Optional end date filter
 * @param options - React Query options (enabled, refetchInterval, etc.)
 */
export function useStrategySummary(
  clientId: string,
  startDate?: string,
  endDate?: string,
  options?: { enabled?: boolean }
) {
  return useQuery<StrategySummary, Error>({
    queryKey: ['strategy-summary', clientId, startDate, endDate],
    queryFn: () => api.getStrategySummary(clientId, startDate, endDate),
    staleTime: 5 * 60 * 1000, // 5 minutes
    ...options,
  });
}
```

---

## 3. StrategyCard Component

### Location
Create: `frontend/src/components/calendar/StrategyCard.tsx`

### Full Component Implementation

```typescript
import React from 'react';
import { StrategySummary } from '@/types/strategy';
import { Lightbulb, Target, Clock, MessageSquare, Sparkles } from 'lucide-react';

interface StrategyCardProps {
  /** Strategy summary data to display */
  summary: StrategySummary;

  /** Optional CSS class for custom styling */
  className?: string;

  /** Whether to show the expanded view by default */
  defaultExpanded?: boolean;
}

/**
 * StrategyCard Component
 *
 * Displays the high-level marketing strategy generated by Claude Sonnet 4.5.
 * Provides collapsible sections for key insights, targeting, timing, and content strategy.
 */
export const StrategyCard: React.FC<StrategyCardProps> = ({
  summary,
  className = '',
  defaultExpanded = true,
}) => {
  const [isExpanded, setIsExpanded] = React.useState(defaultExpanded);

  return (
    <div className={`bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-md border border-purple-200 overflow-hidden ${className}`}>
      {/* Header */}
      <div
        className="px-6 py-4 bg-white/50 backdrop-blur-sm border-b border-purple-200 cursor-pointer hover:bg-white/70 transition-colors"
        onClick={() => setIsExpanded(!isExpanded)}
      >
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-purple-100 rounded-lg">
              <Sparkles className="w-5 h-5 text-purple-600" />
            </div>
            <div>
              <h2 className="text-lg font-semibold text-gray-900">
                Marketing Strategy Overview
              </h2>
              <p className="text-sm text-gray-600">
                {summary.start_date} to {summary.end_date} • {summary.event_count} campaigns
              </p>
            </div>
          </div>
          <button
            className="text-purple-600 hover:text-purple-700 transition-colors"
            aria-label={isExpanded ? 'Collapse strategy' : 'Expand strategy'}
          >
            <svg
              className={`w-5 h-5 transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
      </div>

      {/* Expanded Content */}
      {isExpanded && (
        <div className="p-6 space-y-6">
          {/* Key Insights Section */}
          <section>
            <div className="flex items-center gap-2 mb-3">
              <Lightbulb className="w-5 h-5 text-yellow-600" />
              <h3 className="text-md font-semibold text-gray-900">Key Insights</h3>
            </div>
            <ul className="space-y-2">
              {summary.key_insights.map((insight, index) => (
                <li
                  key={index}
                  className="flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200"
                >
                  <span className="flex-shrink-0 w-6 h-6 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center text-sm font-medium">
                    {index + 1}
                  </span>
                  <span className="text-gray-700 text-sm leading-relaxed">{insight}</span>
                </li>
              ))}
            </ul>
          </section>

          {/* Targeting Approach Section */}
          <section>
            <div className="flex items-center gap-2 mb-3">
              <Target className="w-5 h-5 text-blue-600" />
              <h3 className="text-md font-semibold text-gray-900">Targeting Approach</h3>
            </div>
            <div className="p-4 bg-white rounded-lg border border-gray-200">
              <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-line">
                {summary.targeting_approach}
              </p>
            </div>
          </section>

          {/* Timing Strategy Section */}
          <section>
            <div className="flex items-center gap-2 mb-3">
              <Clock className="w-5 h-5 text-green-600" />
              <h3 className="text-md font-semibold text-gray-900">Timing Strategy</h3>
            </div>
            <div className="p-4 bg-white rounded-lg border border-gray-200">
              <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-line">
                {summary.timing_strategy}
              </p>
            </div>
          </section>

          {/* Content Strategy Section */}
          <section>
            <div className="flex items-center gap-2 mb-3">
              <MessageSquare className="w-5 h-5 text-purple-600" />
              <h3 className="text-md font-semibold text-gray-900">Content Strategy</h3>
            </div>
            <div className="p-4 bg-white rounded-lg border border-gray-200">
              <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-line">
                {summary.content_strategy}
              </p>
            </div>
          </section>

          {/* Footer Metadata */}
          <div className="pt-4 border-t border-purple-200">
            <p className="text-xs text-gray-500 text-center">
              Generated by {summary.generated_by?.replace('claude-sonnet-4-5-', 'Claude Sonnet 4.5 (')} on{' '}
              {summary.created_at ? new Date(summary.created_at).toLocaleDateString() : 'Unknown'}
            </p>
          </div>
        </div>
      )}
    </div>
  );
};
```

### Variant: Compact Card Component

For sidebar or limited space scenarios:

```typescript
/**
 * CompactStrategyCard Component
 *
 * Condensed version showing only key insights with modal expansion.
 */
export const CompactStrategyCard: React.FC<{
  summary: StrategySummary;
  onExpand?: () => void;
}> = ({ summary, onExpand }) => {
  return (
    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <Sparkles className="w-4 h-4 text-purple-600" />
          <h3 className="text-sm font-semibold text-gray-900">Strategy</h3>
        </div>
        <button
          onClick={onExpand}
          className="text-purple-600 hover:text-purple-700 text-xs font-medium"
        >
          View Full
        </button>
      </div>
      <ul className="space-y-2">
        {summary.key_insights.slice(0, 3).map((insight, index) => (
          <li key={index} className="flex items-start gap-2">
            <span className="flex-shrink-0 w-4 h-4 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center text-xs font-medium">
              {index + 1}
            </span>
            <span className="text-xs text-gray-600 line-clamp-2">{insight}</span>
          </li>
        ))}
      </ul>
    </div>
  );
};
```

---

## 4. Calendar View Integration

### Location
Update: `frontend/src/pages/Calendar.tsx` (or your main calendar component)

### Integration Approach

```typescript
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { StrategyCard } from '@/components/calendar/StrategyCard';
import { api } from '@/services/api';
import { StrategySummary } from '@/types/strategy';

export const CalendarPage: React.FC = () => {
  const { clientId } = useParams<{ clientId: string }>();
  const [strategySummary, setStrategySummary] = useState<StrategySummary | null>(null);
  const [strategyLoading, setStrategyLoading] = useState(true);
  const [strategyError, setStrategyError] = useState<string | null>(null);

  // ... existing calendar state ...

  // Fetch strategy summary
  useEffect(() => {
    if (!clientId) return;

    const fetchStrategySummary = async () => {
      try {
        setStrategyLoading(true);
        setStrategyError(null);

        const summary = await api.getStrategySummary(clientId);
        setStrategySummary(summary);
      } catch (error) {
        console.error('Failed to fetch strategy summary:', error);

        // Only show error if it's not a 404 (strategy summary is optional)
        if (error instanceof Error && !error.message.includes('not found')) {
          setStrategyError(error.message);
        }
      } finally {
        setStrategyLoading(false);
      }
    };

    fetchStrategySummary();
  }, [clientId]);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Page Header */}
      <header className="bg-white border-b border-gray-200 px-6 py-4">
        <h1 className="text-2xl font-bold text-gray-900">Campaign Calendar</h1>
        <p className="text-sm text-gray-600">{clientId}</p>
      </header>

      <div className="max-w-7xl mx-auto px-6 py-8">
        {/* Strategy Summary Section */}
        {strategyLoading ? (
          <div className="mb-8">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"></div>
              <p className="text-gray-600 text-sm mt-3">Loading strategy...</p>
            </div>
          </div>
        ) : strategyError ? (
          <div className="mb-8">
            <div className="bg-red-50 border border-red-200 rounded-lg p-4">
              <p className="text-red-800 text-sm">Failed to load strategy: {strategyError}</p>
            </div>
          </div>
        ) : strategySummary ? (
          <div className="mb-8">
            <StrategyCard summary={strategySummary} />
          </div>
        ) : null}

        {/* Calendar Grid */}
        <div className="bg-white rounded-lg shadow-md">
          {/* ... existing calendar implementation ... */}
        </div>
      </div>
    </div>
  );
};
```

### Alternative: React Query Integration

```typescript
import { useStrategySummary } from '@/hooks/useStrategySummary';

export const CalendarPage: React.FC = () => {
  const { clientId } = useParams<{ clientId: string }>();

  const {
    data: strategySummary,
    isLoading: strategyLoading,
    error: strategyError
  } = useStrategySummary(clientId!, undefined, undefined, {
    enabled: !!clientId,
  });

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ... header ... */}

      <div className="max-w-7xl mx-auto px-6 py-8">
        {strategyLoading && (
          <div className="mb-8">
            <StrategyCardSkeleton />
          </div>
        )}

        {!strategyLoading && !strategyError && strategySummary && (
          <div className="mb-8">
            <StrategyCard summary={strategySummary} />
          </div>
        )}

        {/* ... calendar grid ... */}
      </div>
    </div>
  );
};
```

---

## 5. Loading and Error States

### Loading Skeleton Component

Create: `frontend/src/components/calendar/StrategyCardSkeleton.tsx`

```typescript
import React from 'react';

/**
 * Loading skeleton for StrategyCard component.
 * Shows placeholder UI while strategy summary is being fetched.
 */
export const StrategyCardSkeleton: React.FC = () => {
  return (
    <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-md border border-purple-200 overflow-hidden animate-pulse">
      {/* Header Skeleton */}
      <div className="px-6 py-4 bg-white/50 backdrop-blur-sm border-b border-purple-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-purple-200 rounded-lg"></div>
          <div className="flex-1">
            <div className="h-5 bg-purple-200 rounded w-64 mb-2"></div>
            <div className="h-4 bg-purple-100 rounded w-48"></div>
          </div>
        </div>
      </div>

      {/* Content Skeleton */}
      <div className="p-6 space-y-6">
        {/* Key Insights */}
        <div>
          <div className="h-5 bg-gray-200 rounded w-32 mb-3"></div>
          <div className="space-y-2">
            {[1, 2, 3].map((i) => (
              <div key={i} className="p-3 bg-white rounded-lg border border-gray-200">
                <div className="h-4 bg-gray-200 rounded w-full"></div>
              </div>
            ))}
          </div>
        </div>

        {/* Other sections */}
        {[1, 2, 3].map((i) => (
          <div key={i}>
            <div className="h-5 bg-gray-200 rounded w-40 mb-3"></div>
            <div className="p-4 bg-white rounded-lg border border-gray-200">
              <div className="space-y-2">
                <div className="h-4 bg-gray-200 rounded w-full"></div>
                <div className="h-4 bg-gray-200 rounded w-5/6"></div>
                <div className="h-4 bg-gray-200 rounded w-4/6"></div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

### Error Handling Component

Create: `frontend/src/components/calendar/StrategyError.tsx`

```typescript
import React from 'react';
import { AlertCircle, RefreshCw } from 'lucide-react';

interface StrategyErrorProps {
  error: string;
  onRetry?: () => void;
}

/**
 * Error state component for strategy summary failures.
 */
export const StrategyError: React.FC<StrategyErrorProps> = ({ error, onRetry }) => {
  return (
    <div className="bg-red-50 border border-red-200 rounded-lg p-6">
      <div className="flex items-start gap-3">
        <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
        <div className="flex-1">
          <h3 className="text-sm font-semibold text-red-900 mb-1">
            Failed to Load Strategy
          </h3>
          <p className="text-sm text-red-700 mb-3">{error}</p>
          {onRetry && (
            <button
              onClick={onRetry}
              className="inline-flex items-center gap-2 px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition-colors"
            >
              <RefreshCw className="w-4 h-4" />
              Retry
            </button>
          )}
        </div>
      </div>
    </div>
  );
};
```

### Empty State Component

Create: `frontend/src/components/calendar/StrategyEmptyState.tsx`

```typescript
import React from 'react';
import { FileQuestion } from 'lucide-react';

/**
 * Empty state when no strategy summary exists for the calendar.
 * This is normal for calendars created before the strategy summary feature.
 */
export const StrategyEmptyState: React.FC = () => {
  return (
    <div className="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
      <FileQuestion className="w-12 h-12 text-gray-400 mx-auto mb-3" />
      <h3 className="text-sm font-semibold text-gray-900 mb-1">
        No Strategy Summary Available
      </h3>
      <p className="text-sm text-gray-600">
        This calendar was created before the strategy summary feature was added.
      </p>
    </div>
  );
};
```

---

## 6. Styling Guidelines

### Tailwind CSS Theme

Ensure your `tailwind.config.js` includes these colors:

```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        purple: {
          50: '#faf5ff',
          100: '#f3e8ff',
          200: '#e9d5ff',
          600: '#9333ea',
          700: '#7e22ce',
        },
        blue: {
          50: '#eff6ff',
          100: '#dbeafe',
          600: '#2563eb',
        },
      },
    },
  },
};
```

### Design Tokens

```typescript
// frontend/src/styles/strategy.ts

export const strategyCardStyles = {
  container: 'bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-md border border-purple-200',
  header: 'px-6 py-4 bg-white/50 backdrop-blur-sm border-b border-purple-200',
  content: 'p-6 space-y-6',
  section: 'space-y-3',
  sectionTitle: 'flex items-center gap-2 mb-3',
  sectionTitleText: 'text-md font-semibold text-gray-900',
  insightCard: 'flex items-start gap-3 p-3 bg-white rounded-lg border border-gray-200',
  insightNumber: 'flex-shrink-0 w-6 h-6 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center text-sm font-medium',
  contentBox: 'p-4 bg-white rounded-lg border border-gray-200',
  contentText: 'text-gray-700 text-sm leading-relaxed whitespace-pre-line',
};
```

### Responsive Design

The component should be responsive:

```typescript
// Mobile-first responsive classes
<div className={`
  bg-gradient-to-br from-purple-50 to-blue-50
  rounded-lg shadow-md border border-purple-200
  overflow-hidden

  // Mobile (default)
  p-4

  // Tablet (md)
  md:p-6

  // Desktop (lg)
  lg:p-8
`}>
  {/* ... */}
</div>
```

### Dark Mode Support (Optional)

If your calendar supports dark mode:

```typescript
<div className={`
  bg-gradient-to-br from-purple-50 to-blue-50
  dark:from-purple-900/20 dark:to-blue-900/20

  border border-purple-200
  dark:border-purple-700

  rounded-lg shadow-md
`}>
  <h2 className="text-gray-900 dark:text-gray-100">
    Marketing Strategy Overview
  </h2>
  <p className="text-gray-700 dark:text-gray-300">
    {summary.targeting_approach}
  </p>
</div>
```

---

## 7. Component Testing

### Location
Create: `frontend/src/components/calendar/__tests__/StrategyCard.test.tsx`

### Test Suite

```typescript
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { StrategyCard } from '../StrategyCard';
import { StrategySummary } from '@/types/strategy';

// Mock strategy summary data
const mockSummary: StrategySummary = {
  id: 'test-summary-1',
  client_id: 'test-client',
  start_date: '2026-01-01',
  end_date: '2026-01-31',
  key_insights: [
    'Focus on premium SKU sales through education',
    'Leverage seasonal winter themes',
    'Emphasize subscription bundles',
  ],
  targeting_approach: 'Segment by purchase history: VIP customers get exclusive previews, occasional buyers receive re-engagement offers',
  timing_strategy: 'Tuesday/Thursday sends at 10 AM PST for optimal open rates',
  content_strategy: 'Educational content on cheese varieties and pairings, seasonal recipes, behind-the-scenes stories',
  created_at: '2025-11-18T19:48:16Z',
  generated_by: 'claude-sonnet-4-5-20250929',
  event_count: 24,
};

describe('StrategyCard', () => {
  it('renders strategy summary header', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText('Marketing Strategy Overview')).toBeInTheDocument();
    expect(screen.getByText(/2026-01-01 to 2026-01-31/)).toBeInTheDocument();
    expect(screen.getByText(/24 campaigns/)).toBeInTheDocument();
  });

  it('renders all key insights', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText(/premium SKU sales/)).toBeInTheDocument();
    expect(screen.getByText(/seasonal winter themes/)).toBeInTheDocument();
    expect(screen.getByText(/subscription bundles/)).toBeInTheDocument();
  });

  it('renders targeting approach', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText(/Segment by purchase history/)).toBeInTheDocument();
    expect(screen.getByText('Targeting Approach')).toBeInTheDocument();
  });

  it('renders timing strategy', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText(/Tuesday\/Thursday sends/)).toBeInTheDocument();
    expect(screen.getByText('Timing Strategy')).toBeInTheDocument();
  });

  it('renders content strategy', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText(/Educational content/)).toBeInTheDocument();
    expect(screen.getByText('Content Strategy')).toBeInTheDocument();
  });

  it('toggles expanded/collapsed state on header click', () => {
    render(<StrategyCard summary={mockSummary} defaultExpanded={true} />);

    // Initially expanded - content should be visible
    expect(screen.getByText('Key Insights')).toBeInTheDocument();

    // Click header to collapse
    const header = screen.getByText('Marketing Strategy Overview').closest('div')!;
    fireEvent.click(header);

    // Content should be hidden
    expect(screen.queryByText('Key Insights')).not.toBeInTheDocument();

    // Click again to expand
    fireEvent.click(header);

    // Content should be visible again
    expect(screen.getByText('Key Insights')).toBeInTheDocument();
  });

  it('respects defaultExpanded prop', () => {
    const { rerender } = render(<StrategyCard summary={mockSummary} defaultExpanded={false} />);

    // Should be collapsed initially
    expect(screen.queryByText('Key Insights')).not.toBeInTheDocument();

    // Rerender with defaultExpanded={true}
    rerender(<StrategyCard summary={mockSummary} defaultExpanded={true} />);

    // Should be expanded
    expect(screen.getByText('Key Insights')).toBeInTheDocument();
  });

  it('applies custom className', () => {
    const { container } = render(
      <StrategyCard summary={mockSummary} className="custom-class" />
    );

    const card = container.querySelector('.custom-class');
    expect(card).toBeInTheDocument();
  });

  it('displays generated_by metadata', () => {
    render(<StrategyCard summary={mockSummary} />);

    expect(screen.getByText(/Claude Sonnet 4.5/)).toBeInTheDocument();
  });

  it('formats created_at date correctly', () => {
    render(<StrategyCard summary={mockSummary} />);

    // Check that date is formatted (exact format may vary by locale)
    expect(screen.getByText(/11\/18\/2025|18\/11\/2025/)).toBeInTheDocument();
  });

  it('handles missing optional fields gracefully', () => {
    const minimalSummary: StrategySummary = {
      client_id: 'test-client',
      start_date: '2026-01-01',
      end_date: '2026-01-31',
      key_insights: ['Test insight'],
      targeting_approach: 'Test targeting approach with sufficient length',
      timing_strategy: 'Test timing strategy with sufficient length',
      content_strategy: 'Test content strategy with sufficient length',
    };

    render(<StrategyCard summary={minimalSummary} />);

    // Should not crash
    expect(screen.getByText('Marketing Strategy Overview')).toBeInTheDocument();
    expect(screen.getByText('Test insight')).toBeInTheDocument();
  });
});
```

### Integration Test with API

Create: `frontend/src/components/calendar/__tests__/StrategyCard.integration.test.tsx`

```typescript
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import { rest } from 'msw';
import { setupServer } from 'msw/node';
import { CalendarPage } from '@/pages/Calendar';
import { MemoryRouter, Route } from 'react-router-dom';

// Mock API server
const server = setupServer(
  rest.get('/api/calendar/strategy-summary/:clientId', (req, res, ctx) => {
    return res(
      ctx.json({
        id: 'test-summary-1',
        client_id: req.params.clientId,
        start_date: '2026-01-01',
        end_date: '2026-01-31',
        key_insights: ['Test insight 1', 'Test insight 2'],
        targeting_approach: 'Test targeting approach',
        timing_strategy: 'Test timing strategy',
        content_strategy: 'Test content strategy',
        created_at: '2025-11-18T19:48:16Z',
        generated_by: 'claude-sonnet-4-5-20250929',
        event_count: 10,
      })
    );
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

describe('CalendarPage - Strategy Integration', () => {
  it('fetches and displays strategy summary', async () => {
    render(
      <MemoryRouter initialEntries={['/calendar/test-client']}>
        <Route path="/calendar/:clientId">
          <CalendarPage />
        </Route>
      </MemoryRouter>
    );

    // Should show loading state initially
    expect(screen.getByText('Loading strategy...')).toBeInTheDocument();

    // Wait for strategy to load
    await waitFor(() => {
      expect(screen.getByText('Marketing Strategy Overview')).toBeInTheDocument();
    });

    // Verify strategy content is displayed
    expect(screen.getByText('Test insight 1')).toBeInTheDocument();
    expect(screen.getByText('Test insight 2')).toBeInTheDocument();
  });

  it('handles 404 error gracefully (no strategy available)', async () => {
    server.use(
      rest.get('/api/calendar/strategy-summary/:clientId', (req, res, ctx) => {
        return res(ctx.status(404), ctx.json({ detail: 'No strategy summary found' }));
      })
    );

    render(
      <MemoryRouter initialEntries={['/calendar/test-client']}>
        <Route path="/calendar/:clientId">
          <CalendarPage />
        </Route>
      </MemoryRouter>
    );

    await waitFor(() => {
      // Should not show error for 404 (strategy is optional)
      expect(screen.queryByText(/Failed to load strategy/)).not.toBeInTheDocument();

      // Calendar should still render
      expect(screen.getByText('Campaign Calendar')).toBeInTheDocument();
    });
  });

  it('handles API error with error message', async () => {
    server.use(
      rest.get('/api/calendar/strategy-summary/:clientId', (req, res, ctx) => {
        return res(ctx.status(500), ctx.json({ detail: 'Internal server error' }));
      })
    );

    render(
      <MemoryRouter initialEntries={['/calendar/test-client']}>
        <Route path="/calendar/:clientId">
          <CalendarPage />
        </Route>
      </MemoryRouter>
    );

    await waitFor(() => {
      expect(screen.getByText(/Failed to load strategy/)).toBeInTheDocument();
    });
  });
});
```

---

## 8. Accessibility

### ARIA Labels and Roles

```typescript
<div
  role="region"
  aria-label="Marketing strategy overview"
  className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-md"
>
  <button
    onClick={() => setIsExpanded(!isExpanded)}
    aria-expanded={isExpanded}
    aria-controls="strategy-content"
    className="w-full text-left"
  >
    <h2 id="strategy-heading">Marketing Strategy Overview</h2>
  </button>

  <div
    id="strategy-content"
    aria-labelledby="strategy-heading"
    hidden={!isExpanded}
  >
    {/* Content */}
  </div>
</div>
```

### Keyboard Navigation

Ensure all interactive elements are keyboard-accessible:

```typescript
<div
  className="px-6 py-4 cursor-pointer"
  onClick={() => setIsExpanded(!isExpanded)}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      setIsExpanded(!isExpanded);
    }
  }}
  tabIndex={0}
  role="button"
  aria-expanded={isExpanded}
>
  {/* Header content */}
</div>
```

### Screen Reader Support

Provide meaningful text for screen readers:

```typescript
<span className="sr-only">
  Strategy overview for {summary.client_id} covering {summary.start_date} to {summary.end_date}
</span>
```

---

## 9. Documentation Updates

### Update Calendar Component README

Add to: `frontend/src/components/calendar/README.md`

```markdown
## StrategyCard Component

### Overview

The `StrategyCard` component displays high-level marketing strategy generated by Claude Sonnet 4.5 during calendar creation. It provides strategic context for the campaign calendar period.

### Usage

```tsx
import { StrategyCard } from '@/components/calendar/StrategyCard';
import { StrategySummary } from '@/types/strategy';

const summary: StrategySummary = {
  client_id: 'rogue-creamery',
  start_date: '2026-01-01',
  end_date: '2026-01-31',
  key_insights: [...],
  targeting_approach: '...',
  timing_strategy: '...',
  content_strategy: '...',
};

<StrategyCard summary={summary} />
```

### Props

| Prop | Type | Required | Default | Description |
|------|------|----------|---------|-------------|
| `summary` | `StrategySummary` | Yes | - | Strategy summary data to display |
| `className` | `string` | No | `''` | Custom CSS classes |
| `defaultExpanded` | `boolean` | No | `true` | Initial expanded state |

### Features

- **Collapsible sections**: Click header to expand/collapse
- **Icon indicators**: Visual icons for each strategy section
- **Responsive design**: Works on mobile, tablet, and desktop
- **Loading states**: Skeleton loader while fetching
- **Error handling**: Graceful error display
- **Accessibility**: ARIA labels, keyboard navigation

### Data Source

Strategy summaries are fetched from:
```
GET /api/calendar/strategy-summary/{client_id}?start_date=YYYY-MM-DD&end_date=YYYY-MM-DD
```

### Integration

The component is integrated into the main `CalendarPage`:

```tsx
import { useStrategySummary } from '@/hooks/useStrategySummary';

const { data, isLoading, error } = useStrategySummary(clientId);

{data && <StrategyCard summary={data} />}
```
```

---

## 10. Testing with Real Data

### Manual Testing Checklist

- [ ] 1. **Fetch strategy summary**: Verify API call succeeds for client with strategy
- [ ] 2. **Display all sections**: Confirm key insights, targeting, timing, and content appear
- [ ] 3. **Expand/collapse**: Test header click toggles content visibility
- [ ] 4. **Loading state**: Verify skeleton shows while fetching
- [ ] 5. **Error handling**: Test with invalid client ID (should handle gracefully)
- [ ] 6. **Empty state**: Test with client that has no strategy (should show empty state or hide)
- [ ] 7. **Responsive design**: Test on mobile, tablet, and desktop viewports
- [ ] 8. **Keyboard navigation**: Tab through component, press Enter to expand/collapse
- [ ] 9. **Screen reader**: Test with NVDA/JAWS to verify accessible labels
- [ ] 10. **Date formatting**: Verify dates display correctly in user's locale

### Test Workflow

1. **Run emailpilot-simple workflow** for a client:
   ```bash
   cd emailpilot-simple
   python3 api.py
   # Trigger workflow for rogue-creamery
   ```

2. **Import to emailpilot-app**:
   ```bash
   cd emailpilot-simple
   python3 import_calendar_to_app.py
   ```

3. **Start frontend**:
   ```bash
   cd emailpilot-app/frontend
   npm run dev
   ```

4. **Navigate to calendar**:
   ```
   http://localhost:5173/calendar/rogue-creamery
   ```

5. **Verify strategy card** appears with:
   - 3-5 key insights
   - Targeting approach text
   - Timing strategy text
   - Content strategy text
   - Correct date range
   - Event count

### API Testing with curl

```bash
# Test strategy summary endpoint
curl -X GET "http://localhost:8008/api/calendar/strategy-summary/rogue-creamery" \
  -H "Content-Type: application/json"

# Expected response:
{
  "id": "...",
  "client_id": "rogue-creamery",
  "start_date": "2026-01-01",
  "end_date": "2026-01-31",
  "key_insights": [
    "Focus on cheese pairing education...",
    "Leverage seasonal winter themes...",
    "Emphasize gift boxes..."
  ],
  "targeting_approach": "...",
  "timing_strategy": "...",
  "content_strategy": "...",
  "created_at": "2025-11-18T19:48:16Z",
  "generated_by": "claude-sonnet-4-5-20250929",
  "event_count": 24
}
```

---

## 11. Success Criteria

Phase 3 is complete when:

✅ **1. TypeScript Interfaces Created**
- [ ] `StrategySummary` interface matches backend schema
- [ ] All fields properly typed (string, string[], optional fields)
- [ ] Interface exported from `types/strategy.ts`

✅ **2. API Client Integration**
- [ ] `getStrategySummary()` method implemented
- [ ] Handles query parameters (start_date, end_date)
- [ ] Proper error handling for 404 and other errors
- [ ] Type-safe response parsing

✅ **3. StrategyCard Component Built**
- [ ] Renders all strategy sections (insights, targeting, timing, content)
- [ ] Expand/collapse functionality works
- [ ] Icons displayed for each section
- [ ] Proper Tailwind styling applied
- [ ] Component accepts props (summary, className, defaultExpanded)

✅ **4. Calendar Integration**
- [ ] StrategyCard integrated into Calendar page
- [ ] Component fetches strategy on page load
- [ ] Positioned above or beside calendar grid
- [ ] Does not interfere with existing calendar functionality

✅ **5. Loading and Error States**
- [ ] Skeleton loader shows while fetching
- [ ] Error component displays on failure
- [ ] Empty state shows when no strategy exists
- [ ] Loading states don't block calendar rendering

✅ **6. Styling Complete**
- [ ] Gradient background (purple-50 to blue-50)
- [ ] Consistent spacing and typography
- [ ] Responsive design (mobile, tablet, desktop)
- [ ] Icons from lucide-react integrated
- [ ] Accessible color contrast (WCAG AA)

✅ **7. Tests Written**
- [ ] Unit tests for StrategyCard component (8+ tests)
- [ ] Integration tests with mock API
- [ ] Tests cover expand/collapse, rendering, error states
- [ ] All tests passing

✅ **8. Accessibility Implemented**
- [ ] ARIA labels and roles added
- [ ] Keyboard navigation functional (Tab, Enter)
- [ ] Screen reader tested (NVDA/JAWS)
- [ ] Focus indicators visible

✅ **9. Documentation Updated**
- [ ] Component README includes usage examples
- [ ] Props documented
- [ ] Integration instructions provided
- [ ] API endpoint documented

✅ **10. Real Data Testing**
- [ ] Tested with actual workflow output
- [ ] Strategy displays correctly in calendar
- [ ] All sections render properly
- [ ] No console errors or warnings

---

## Deployment Considerations

### Build Verification

Before deploying to production:

```bash
# Run type check
npm run type-check

# Run linter
npm run lint

# Run tests
npm run test

# Build for production
npm run build

# Verify build succeeded
ls -la dist/
```

### Environment Variables

Ensure frontend has API URL configured:

```bash
# .env.production
VITE_API_URL=https://api.emailpilot.com
```

### Performance

- **Code splitting**: Strategy components are lazy-loaded if not immediately visible
- **Memoization**: Use `React.memo()` for StrategyCard if parent re-renders frequently
- **API caching**: Strategy summary should be cached for 5-10 minutes (React Query)

```typescript
// Optimize with React.memo
export const StrategyCard = React.memo<StrategyCardProps>(({ summary, className, defaultExpanded }) => {
  // ... component implementation
});
```

### Error Monitoring

Add error tracking for production:

```typescript
import * as Sentry from '@sentry/react';

const fetchStrategySummary = async () => {
  try {
    const summary = await api.getStrategySummary(clientId);
    setStrategySummary(summary);
  } catch (error) {
    Sentry.captureException(error, {
      tags: { component: 'StrategyCard', client_id: clientId },
    });
    setStrategyError(error.message);
  }
};
```

---

## Rollback Plan

If issues arise after deployment:

### 1. Feature Flag

Add feature flag to hide strategy card:

```typescript
const SHOW_STRATEGY_SUMMARY = import.meta.env.VITE_FEATURE_STRATEGY_SUMMARY === 'true';

{SHOW_STRATEGY_SUMMARY && strategySummary && (
  <StrategyCard summary={strategySummary} />
)}
```

### 2. Component Removal

Remove StrategyCard from Calendar:

```typescript
// Comment out strategy section
{/*
{strategySummary && (
  <div className="mb-8">
    <StrategyCard summary={strategySummary} />
  </div>
)}
*/}
```

### 3. API Endpoint Disable

If backend issues occur, frontend gracefully handles 404:

```typescript
// Already implemented - 404 errors are suppressed
if (error instanceof Error && !error.message.includes('not found')) {
  setStrategyError(error.message);
}
```

---

## Additional Resources

### Figma Design

If design mockups exist, reference them here:
- [Strategy Card Design - Figma](link-to-figma)

### Backend API Documentation

- Phase 2 Instructions: `docs/PHASE_2_EMAILPILOT_APP_INSTRUCTIONS.md`
- OpenAPI Docs: http://localhost:8008/docs

### Icon Library

- [Lucide React Icons](https://lucide.dev/icons/)
- Used icons: `Sparkles`, `Lightbulb`, `Target`, `Clock`, `MessageSquare`

### Related Documentation

- React Testing Library: https://testing-library.com/react
- Tailwind CSS: https://tailwindcss.com/docs
- React Query: https://tanstack.com/query/latest/docs/react/overview

---

## Questions and Support

If you encounter issues during Phase 3 implementation:

1. **TypeScript Errors**: Verify backend schema matches frontend interfaces exactly
2. **API 404 Errors**: Confirm Phase 2 backend deployment is complete
3. **Styling Issues**: Check Tailwind config includes purple and blue colors
4. **Component Not Rendering**: Verify strategy summary fetch is working in DevTools Network tab

For additional support, consult:
- Phase 2 backend documentation
- EmailPilot frontend architecture guide
- React component library standards

---

## Summary

Phase 3 implementation adds visual strategy summary display to the EmailPilot Calendar frontend. The StrategyCard component fetches data from the Phase 2 backend endpoint and presents it in a collapsible, accessible, and visually appealing format.

**Key implementation points:**
- TypeScript interfaces ensure type safety
- React component with expand/collapse functionality
- Tailwind CSS for consistent styling
- Comprehensive error handling and loading states
- Full test coverage with React Testing Library
- Accessible design with ARIA labels and keyboard navigation

Once Phase 3 is complete, proceed to **Phase 4: End-to-End Testing** to verify the full strategy summary workflow from emailpilot-simple generation through frontend display.
